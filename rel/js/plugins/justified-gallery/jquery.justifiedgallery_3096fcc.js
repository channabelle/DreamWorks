!function(e){e.fn.justifiedGallery=function(t){function i(e,t){return'<div class="jg-error '+t+'"style="">'+e+"</div>"}function n(t,i,n){e(t).find(".jg-loading").fadeOut(500,function(){e(this).remove(),s(e,t,i,0,n),e.isFunction(n.onComplete)&&n.onComplete.call(this,t)})}function a(e,t,i,n,a,r,l){var s;return s='<div class="jg-image" style="left:'+a+'px">',s+=' <a href="'+e.href+'" ',"undefined"!=typeof e.rel&&(s+='rel="'+e.rel+'"'),"undefined"!=typeof e.target&&(s+='target="'+e.target+'"'),s+='title="'+e.title+'">',s+='  <img alt="'+e.alt+'" src="'+e.src+t+e.extension+'"',s+='style="width: '+i+"px; height: "+n+'px;">',l.captions&&(s+='  <div style="bottom:'+(n-r)+'px;" class="jg-image-label">'+e.alt+"</div>"),s+=" </a></div>"}function r(e,t,i,n){for(var r,s,g=0,r=0;r<e.length;r++)e[r].nh=Math.ceil(t[e[r].indx].height*((t[e[r].indx].width+i)/t[e[r].indx].width)),e[r].nw=t[e[r].indx].width+i,e[r].suffix=l(e[r].nw,e[r].nh,n),e[r].l=g,n.fixedHeight||(0==r?s=e[r].nh:s>e[r].nh&&(s=e[r].nh)),g+=e[r].nw+n.margins;n.fixedHeight&&(s=n.rowHeight);for(var f="",r=0;r<e.length;r++)f+=a(t[e[r].indx],e[r].suffix,e[r].nw,e[r].nh,e[r].l,s,n);return'<div class="jg-row" style="height: '+s+"px; margin-bottom:"+n.margins+'px;">'+f+"</div>"}function l(e,t,i){var n;return n=e>t?e:t,100>=n?i.sizeRangeSuffixes.lt100:240>=n?i.sizeRangeSuffixes.lt240:320>=n?i.sizeRangeSuffixes.lt320:500>=n?i.sizeRangeSuffixes.lt500:640>=n?i.sizeRangeSuffixes.lt640:i.sizeRangeSuffixes.lt1024}function s(e,t,n,a,l){var s,f,d,o=new Array,h=0,u=e(t).width();for(f=0,s=0;f<n.length;f++)null!=n[f]&&(h+n[f].width+l.margins<=u?(h+=n[f].width+l.margins,o[s]=new Array(5),o[s].indx=f,s++):(d=Math.ceil((u-h+1)/o.length),e(t).append(r(o,n,d,l)),o=new Array,o[0]=new Array(5),o[0].indx=f,s=1,h=n[f].width+l.margins));d=l.justifyLastRow?Math.ceil((u-h+1)/o.length):0,e(t).append(r(o,n,d,l)),l.captions&&(e(t).find(".jg-image").mouseenter(function(t){e(t.currentTarget).find(".jg-image-label").stop(),e(t.currentTarget).find(".jg-image-label").fadeTo(500,.7)}),e(t).find(".jg-image").mouseleave(function(t){e(t.currentTarget).find(".jg-image-label").stop(),e(t.currentTarget).find(".jg-image-label").fadeTo(500,0)})),e(t).find(".jg-resizedImageNotFound").remove(),e(t).find(".jg-image img").load(function(){e(this).fadeTo(500,1)}).error(function(){e(t).prepend(i("The image can't be loaded: \""+e(this).attr("src")+'"',"jg-resizedImageNotFound"))}).each(function(){this.complete&&e(this).load()}),g(e,t,n,u,l)}function g(e,t,i,n,a){var r=setInterval(function(){return n!=e(t).width()?(e(t).find(".jg-row").remove(),clearInterval(r),void s(e,t,i,n,a)):void 0},a.refreshTime)}var f=e.extend({sizeRangeSuffixes:{lt100:"_t",lt240:"_m",lt320:"_n",lt500:"",lt640:"_z",lt1024:"_b"},rowHeight:120,margins:1,justifyLastRow:!0,fixedHeight:!1,captions:!0,rel:null,target:null,extension:/\.[^.]+$/,refreshTime:500,onComplete:null},t);return this.each(function(t,a){e(a).addClass("justifiedGallery");var r=0,l=new Array(e(a).find("img").length);0!=l.length&&(e(a).append('<div class="jg-loading"><div class="jg-loading-img"></div></div>'),e(a).find("a").each(function(t,s){var g=e(s).find("img");l[t]=new Array(5),l[t].src="undefined"!=typeof e(g).data("safe-src")?e(g).data("safe-src"):e(g).attr("src"),l[t].alt=e(g).attr("alt"),l[t].href=e(s).attr("href"),l[t].title=e(s).attr("title"),l[t].rel=null!=f.rel?f.rel:e(s).attr("rel"),l[t].target=null!=f.target?f.target:e(s).attr("target"),l[t].extension=l[t].src.match(f.extension)[0],e(s).remove();var d=new Image;e(d).load(function(){l[t].width=l[t].height!=f.rowHeight?Math.ceil(this.width/(this.height/f.rowHeight)):this.width,l[t].height=f.rowHeight;var e=new RegExp("("+f.sizeRangeSuffixes.lt100+"|"+f.sizeRangeSuffixes.lt240+"|"+f.sizeRangeSuffixes.lt320+"|"+f.sizeRangeSuffixes.lt500+"|"+f.sizeRangeSuffixes.lt640+"|"+f.sizeRangeSuffixes.lt1024+")$");l[t].src=l[t].src.replace(f.extension,"").replace(e,""),++r==l.length&&n(a,l,f)}),e(d).error(function(){e(a).prepend(i("The image can't be loaded: \""+l[t].src+'"',"jg-usedPrefixImageNotFound")),l[t]=null,++r==l.length&&n(a,l,f)}),e(d).attr("src",l[t].src)}))})}}(jQuery);